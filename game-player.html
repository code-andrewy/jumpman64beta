<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jumpman64 Beta</title>
  <style>
    :root {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #f5f5f5;
    }

    body {
      margin: 0;
      background-color: var(--bg);
      color: var(--text);
      font-family: "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .loader-container {
      text-align: center;
      animation: fadeIn 1s ease forwards;
      max-width: 600px;
      padding: 0 1rem;
    }

    .loader-container h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      animation: slideIn 1s ease forwards;
    }

    #skipButton {
      margin: 0.5rem 0 1rem;
      padding: 0.4rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      background-color: var(--card);
      color: var(--text);
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #skipButton:hover {
      background-color: #333;
    }

    .github-text {
      color: #bbb;
      font-size: 1rem;
      min-height: 2.5rem;
      opacity: 0;
      transition: opacity 1s ease;
      margin-bottom: 1.5rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .loading-gallery {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      max-width: 90vw;
      animation: fadeIn 2s ease-in;
    }

    .loading-img {
      width: 140px;
      height: 90px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s;
    }

    .loading-img:hover {
      transform: scale(1.05);
    }

    iframe {
      width: 100%;
      height: 100vh;
      border: none;
      display: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <div id="loader" class="loader-container">
    <h1>Jumpman64 Beta</h1>
    <button id="skipButton">Skip Loading</button>
    <div id="githubText" class="github-text"></div>
    <p>Loading your game...</p>
    <div id="loading-images" class="loading-gallery"></div>
  </div>

  <iframe id="gameFrame"></iframe>

  <script>
    const imageSourceURL = "https://raw.githubusercontent.com/code-andrewy/Games1232/refs/heads/main/image.text";
    const githubTextURL = "https://raw.githubusercontent.com/code-andrewy/cooltext/refs/heads/main/text";

    const loader = document.getElementById("loader");
    const iframe = document.getElementById("gameFrame");
    const loadingImages = document.getElementById("loading-images");
    const skipButton = document.getElementById("skipButton");
    const githubText = document.getElementById("githubText");

    const gameURL = new URLSearchParams(window.location.search).get("game");

    function getRandom(arr, count) {
      const shuffled = arr.sort(() => 0.5 - Math.random());
      return shuffled.slice(0, count);
    }

    function addImagesToLoader(imageUrls) {
      const selected = getRandom(imageUrls, Math.floor(Math.random() * 3) + 3);
      selected.forEach(url => {
        const img = document.createElement("img");
        img.src = url;
        img.className = "loading-img";
        loadingImages.appendChild(img);
      });
    }

    async function fetchImageURLs() {
      try {
        const res = await fetch(imageSourceURL);
        const text = await res.text();
        const urls = text
          .split("\n")
          .map(line => line.trim())
          .filter(line => line.startsWith("Image url:"))
          .map(line => line.replace("Image url:", "").trim());
        addImagesToLoader(urls);
      } catch (err) {
        console.error("Failed to fetch image list:", err);
      }
    }

    async function fetchGithubText() {
      try {
        const res = await fetch(githubTextURL);
        if (!res.ok) throw new Error("Network response was not ok");
        const text = await res.text();
        const lines = text
          .split("\n")
          .map(line => line.trim())
          .filter(line => line.length > 0);
        const randomLine = lines[Math.floor(Math.random() * lines.length)];
        githubText.textContent = randomLine;
        githubText.style.opacity = "1";
      } catch (err) {
        console.error("Failed to fetch GitHub text:", err);
        githubText.textContent = "Failed to load info.";
        githubText.style.opacity = "1";
      }
    }

    fetchImageURLs();
    fetchGithubText();

    function loadGame() {
      if (!gameURL) {
        document.querySelector("p").textContent = "No game URL provided in ?game=...";
        return;
      }
      loader.style.display = "none";
      iframe.src = gameURL;
      iframe.style.display = "block";
    }

    skipButton.addEventListener("click", () => {
      loadGame();
    });

    // Auto load game after 3500ms
    if (gameURL) {
      setTimeout(loadGame, 3500);
    }
  </script>
</body>
</html>
