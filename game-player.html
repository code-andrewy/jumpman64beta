<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jumpman64 Beta - Game Player</title>
  <style>
    :root {
      --bg: #121212;
      --card: #1e1e1e;
      --accent: #000000;
      --text: #f5f5f5;
      --text-muted: #bbbbbb;
    }

    body {
      margin: 0;
      background-color: var(--bg);
      font-family: "Segoe UI", sans-serif;
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }

    #loader img {
      width: 200px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 0 20px #0ff5;
      margin-bottom: 20px;
    }

    #loader h1 {
      font-size: 2em;
      color: #0ff;
      text-shadow: 0 0 10px #0ff8;
      margin: 0;
    }

    iframe {
      width: 100%;
      height: 100vh;
      border: none;
      display: none;
      position: relative;
      z-index: 1;
    }

    @media (max-width: 600px) {
      iframe {
        height: 80vh;
      }
    }
  </style>
</head>
<body>

  <div id="loader">
    <img id="preview" src="" alt="Game Preview">
    <h1>Jumpman64 Beta</h1>
  </div>

  <iframe id="gameFrame"></iframe>

  <script>
    const params = new URLSearchParams(window.location.search);
    const gameURL = params.get("game");
    const gameFrame = document.getElementById("gameFrame");
    const loader = document.getElementById("loader");
    const preview = document.getElementById("preview");

    // Fetch and parse game data
    async function fetchGameData() {
      try {
        const response = await fetch("https://raw.githubusercontent.com/code-andrewy/Games1232/main/text.txt");
        const text = await response.text();
        const games = parseGameData(text);
        return games;
      } catch (error) {
        console.error("Error fetching game data:", error);
        return [];
      }
    }

    // Parse games from raw text
    function parseGameData(text) {
      const chunks = text.split("Website url:").slice(1);
      const games = [];

      chunks.forEach(chunk => {
        const urlMatch = chunk.match(/(https?:\/\/[^\s]+)/);
        const nameMatch = chunk.match(/Game name:\s*(.+?)(?=Image url:|$)/);
        const imageMatch = chunk.match(/Image url:\s*(https?:\/\/[^\s]+)/);

        if (urlMatch && nameMatch && imageMatch) {
          games.push({
            url: urlMatch[1].trim(),
            name: nameMatch[1].trim(),
            image: imageMatch[1].trim()
          });
        }
      });

      return games;
    }

    // Only use games 5â€“8 (index 4 to 7)
    function selectImageFromSubset(games) {
      const subset = games.slice(4, 8); // JS is 0-indexed
      if (subset.length > 0) {
        const random = subset[Math.floor(Math.random() * subset.length)];
        preview.src = random.image;
      }
    }

    async function init() {
      const games = await fetchGameData();
      selectImageFromSubset(games);

      if (gameURL) {
        gameFrame.src = gameURL;
        gameFrame.onload = () => {
          loader.style.opacity = "0";
          setTimeout(() => {
            loader.style.display = "none";
            gameFrame.style.display = "block";
          }, 500);
        };
      } else {
        loader.innerHTML = "<h2 style='text-align:center;'>No game URL provided.</h2>";
      }
    }

    init();
  </script>

</body>
</html>
