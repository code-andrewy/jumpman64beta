<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jumpman64 Beta - Game Player</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      background-color: #111;
      color: white;
    }
    #loader {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2;
      transition: opacity 0.5s ease;
    }
    #loader img {
      width: 200px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 0 20px #0ff5;
      margin-bottom: 20px;
    }
    #loader h1 {
      font-size: 2em;
      color: #0ff;
      text-shadow: 0 0 10px #0ff8;
      margin: 0;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: none;
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body>

  <div id="loader">
    <img id="preview" src="" alt="Game Preview">
    <h1>Jumpman64 Beta</h1>
  </div>

  <iframe id="gameFrame"></iframe>

  <script>
    const params = new URLSearchParams(window.location.search);
    const gameURL = params.get("game");
    const gameFrame = document.getElementById("gameFrame");
    const loader = document.getElementById("loader");
    const preview = document.getElementById("preview");

    // Function to fetch and parse game data
    async function fetchGameData() {
      try {
        const response = await fetch("https://raw.githubusercontent.com/code-andrewy/Games1232/refs/heads/main/text.txt");
        const text = await response.text();
        const games = parseGameData(text);
        return games;
      } catch (error) {
        console.error("Error fetching game data:", error);
        return [];
      }
    }

    // Function to parse the raw text into game objects
    function parseGameData(text) {
      const lines = text.split("Website url:");
      const games = [];

      lines.forEach(line => {
        if (line.trim() === "") return;

        const urlMatch = line.match(/(https?:\/\/[^\s]+)/);
        const nameMatch = line.match(/Game name:\s*(.+?)(?=Image url:|$)/);
        const imageMatch = line.match(/Image url:\s*(https?:\/\/[^\s]+)/);

        if (urlMatch && nameMatch && imageMatch) {
          games.push({
            url: urlMatch[1].trim(),
            name: nameMatch[1].trim(),
            image: imageMatch[1].trim()
          });
        }
      });

      return games;
    }

    // Function to select a random game image
    function selectRandomImage(games) {
      if (games.length === 0) return;
      const randomGame = games[Math.floor(Math.random() * games.length)];
      preview.src = randomGame.image;
    }

    // Main function to initialize the page
    async function init() {
      const games = await fetchGameData();
      selectRandomImage(games);

      if (gameURL) {
        gameFrame.src = gameURL;
        gameFrame.onload = () => {
          loader.style.opacity = "0";
          setTimeout(() => {
            loader.style.display = "none";
            gameFrame.style.display = "block";
          }, 500);
        };
      } else {
        loader.innerHTML = "<h2 style='text-align:center;'>No game URL provided.</h2>";
      }
    }

    // Initialize the page
    init();
  </script>

</body>
</html>
